import "Srl/Memory.alusus";
import "Srl/Array.alusus";
import "libcivetweb.so";
اشمل "Http.alusus";
اشمل"مـتم/مـصفوفة.أسس"؛
 
عرف بـننف: لقب Http؛
@دمج وحدة بـننف{
عرف اتـصال: لقب Connection؛

عرف سـياق: لقب Context؛
    صنف سـياق {

        عرف توقف: صحيح;
    };


    عرف نـداء_الطلب: لقب مؤشر[دالة (اتصال: مؤشر [اتـصال]): صحيح];


   عرف مـنادى: لقب Callbacks؛
   @دمج صنف مـنادى{
     
        عرف بداية_الطلب: نـداء_الطلب;
        
        عرف نهاية_الطلب: مؤشر[دالة (اتصال: مؤشر[اتـصال], اعادة_رد_الرمز: صحيح)];

        
        عرف رسالة_السجل: لقب logMessage؛


    
        عرف ولوج_سجل: لقب  logAccess؛



        عرف هيئ_طما:لقب initSsl؛

       عرف غلق_الاتصال: لقب connectionClose؛

        عرف  افتح_ملف: مؤشر[دالة (الإتصال: مؤشر[اتـصال],

                                نهج: مـؤشر_محارف,

                                لين_البيانات: مؤشر): مـحرف];
        
        عرف بننف_خطأ: مؤشر[دالة (اتصال: مؤشر[اتـصال], الحالة: صحيح): صحيح];

        عرف بداية_السياق: مؤشر[دالة (سياق: مؤشر[سـياق]): فـراغ];

        
        عرف بداية_الموضوع: لقب initThread؛


        عرف نهاية_السياق: مؤشر[دالة (سياق: مؤشر[سـياق]): فـراغ];
    };

    
   عرف مـعلومات_الطلب: لقب RequestInfo؛
    @دمج صنف مـعلومات_الطلب{

        عرف طلب_منهج: لقب requestMethod؛


        عرف طلب_ممم: لقب requestUri؛
        
                                    
                                    
         عرف معرف_محلي:لقب localUri؛

        عرف ممم: لقب uri;

        عرف اصدار_بننف: لقب httpVersion؛


        عرف نص_الاستعلام: لقب queryString؛


        عرف مستخدم_بعيد: لقب remoteUser؛

        عرف عنوان_بعيد: لقب remoteAddr؛



        عرف طول_المحتوى: لقب contentLength؛

        عرف منفذ_بعيد: لقب remotePort؛

        عرف هو_طبقة_المقبس_آمن: لقب isSsl؛

        عرف بيانات_المستخدم: لقب userData؛

        عرف اتصال_البيانات: لقب connData؛


        عرف عدد_المقدمة: لقب numberHeaders؛


        عرف مقدمة_بننف: لقب httpHeaders؛
    };


    دالة الـمقدمة {

        عرف اسم: مـؤشر_محارف

        عرف قيمة: مـؤشر_محارف
    };


  عرف اتـصال: لقب Connection؛
   @دمج صنف اتـصال{

         عرف طلب_معلومات: لقب requestInfo؛

        عرف سياق: لقب context؛

        عرف طبقة_المقبس_آمن: لقب ssl؛

        عرف سياق_لعميل_طبقة_المقبس_آمن: لقب clientSslContext؛

        عرف عميل: لقب client؛


        عرف موعد_الاتصال: لقب connectionBirthTime؛


        عرف طلب_وقت: لقب requestTime؛

        عرف عدد_البايت_المرسلة: لقب numberBytesSent؛

        عرف حجم_المحتوى: لقب contentLen؛
        

        عرف محتوى_مستهلك: لقب consumedContent؛


        عرف مقسم: لقب isChunked؛

        عرف البقاية: لقب chunkRemainder؛

        عرف متعادل: لقب buf؛

        عرف طرق_المعلومات: لقب pathInfo؛


        عرف يجب_الاغلاق: لقب mustClose؛



        عرف معالجة_الاخطاء: لقب inErrorHandler؛


        عرف خطأ_داخلي: لقب internalError؛


        عرف حجم_المخزن: لقب bufSize؛

        عرف حجم_الطلب: لقب request_len؛

        عرف حجم_البيانات: لقب data_len؛

        عرف رمز_الحالة: لقب status_code؛
        


        عرف ضغط: لقب throttle؛

        عرف اخر_البيانات_المرسلة: لقب last_throttle_time؛
        


        عرف البيانات_المرسلة_حاليا: لقب last_throttle_bytes؛
         

        عرف المزامنة: لقب mutex؛
    };
    

    @expname[mg_start]

    


    
عرف توقف: لقب stop؛ 
    @expname[mg_stop]

    

    دالة اغلاق_الخادم(سياق: مؤشر[سـياق]): فـراغ


    @expname[mg_read]

    عرف أقرا: لقب read؛
   

    دالة أقرا(اتصال: مؤشر[اتـصال], متعادل: مؤشر, حجم_متعادل: صحيح): صحيح؛


    @expname[mg_write]

    عرف اكتب: لقب write؛
   

    دالة اكتب(اتصال: مؤشر[اتـصال], متعادل: مـؤشر_محارف, حجم_متعادل: صحيح): صحيح؛ 


    @expname[mg_printf]

    

    دالة اطبع(اتصال: مؤشر[اتـصال], صيغة: مـؤشر_محارف, ...أيما): صحيح؛

    @expname[mg_send_file]
    عرف ملف_مرسل: لقب send_file؛

     

    دالة ملف_مرسل(اتصال: مؤشر[اتـصال], أسم_الملف: مـؤشر_محارف): فـارغ؛

   @expname[mg_send_mime_file] 
     عرف تمثيل_الملف_المرسل: لقب send_mime_file؛


    دالة ملف_مرسل(اتصال: مؤشر[اتـصال], اسم_الملف: مـؤشر_محارف, تمثيل: مـؤشر_محارف): فـارغ؛ 

   @expname[mg_get_cookie]
   عرف هات_الارتباط: لقب get_cookie؛

    

    دالة هات_الارتباط(نص_هات_الارتباط: مـؤشر_محارف, اسم_الارتباط: مـؤشر_محارف,   خارج_محتوى_الارتباط: مـؤشر_محارف, خارج_حجم_الارتباط: طـبيعي[64]): صحيح؛

   @expname[mg_get_header]
   عرف هات_المقدمة: لقب get_header؛

    

    دالة هات_مقدمة (اتصال: مؤشر[اتـصال], اسم_المقدمة: مـؤشر_محارف): مـؤشر_محارف؛


   عرف هات_معلومات_الطلب: لقب getRequestInfo؛

    




   عرف هات_متغير: لقب getVariable؛

   




    عرف  أنشئ_الخادم: لقب createServer؛
}
